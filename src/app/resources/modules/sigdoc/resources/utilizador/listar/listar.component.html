<app-redefinir-senha [utilizador]="this.utilizador" (onSucesso)="this.actualizarTabela()"></app-redefinir-senha>
<app-eliminar [utilizador]="this.utilizador" (onEliminar)="this.actualizarTabela()"></app-eliminar>
<app-activa-desactiva [utilizador]="this.utilizador" (onActiva)="this.actualizarTabela()"></app-activa-desactiva>

<main id="main_" class="main_">
    <div class="content">
        <div class="header-ficha">
            <div class="row">
              <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 d-flex justify-content-start align-items-start"
                style="row-gap: 0.8rem;">
                <div class="image">
                  <img src="assets/img/logopolice.png" alt="image-logo" style="width: 80px; height: 80px;" />
                </div>
                <div class="logos mx-2">
                  <h1>POLÍCIA NACIONAL DE ANGOLA</h1>
                  <h3 class="text-uppercase">
                    Sistema Integrado de Gestão - Documental e Arquivos
                  </h3>
                </div>
              </div>
            </div>
          </div>
        <div class="header-ficha mt-1">
            <div class="row" style="align-items: center;">
                <div class="col-xl-8 col-lg-8 col-md-8 col-sm-12 d-flex justify-content-start align-items-start">
                    <div class="mais-info d-flex justify-content-center align-items">
                        <h4 class="text-white"><b>Listagem dos Utilizadores</b></h4>
                    </div>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 d-flex justify-content-end align-items-start">
                    <a href="javascript:void(0)" (click)="this.registar()" data-toggle="modal"
                        data-target="#modalRegistarOuEditarUtilizador"
                        class="btn-piips btn-piips-secondary border m-0 py-1"><i class="fa fa-plus-circle"></i> Registar</a>
                </div>
            </div>
        </div>
        <div class="row" style="row-gap: .8rem;">
            <div class="col-xl-12 col-lg-12 col-md-col-12 col-sm-12 my-2">
                <form class="row" style="align-items: center;">
                    <div class="col-xl-1 col-lg-1 col-md-6 col-sm-12">
                        <select class="form-control" style="width: 100%!important; padding: .8rem auto;"
                            (change)="filtrarPagina('perPage',$event)">
                            <option *ngFor="let item of [5,10,20,50]" [value]="item">{{item}}</option>
                        </select>
                    </div>
                    <div class="col-xl-9 col-lg-9 col-md-12 col-sm-12">
                        <input class="form-control w-100" type="text" [ngModel]="this.filtro.search"
                            (ngModelChange)="filtrarPagina('search',$event)" placeholder="Pesquisa ...">
                    </div>
                    <div class="col-xl-2 col-lg-2 col-md-12 col-sm-12 d-flex justify-content-end align-items-center">
                        <button (click)="this.recarregarPagina()" class="btn-piips btn-piips-secondary m-0" type="submit">
                            <i style="font-size: 14px;" class="fa fa-refresh fa-spin fa-3x fa-fw"></i>
                            <b>Recarregar</b>
                        </button>
                    </div>
                </form>
    
            </div>
            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
                <aside class="row">
                    <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12">
                        <label><b>Módulo</b></label><br>
                        <ng-select2 [options]="options" [data]="this.modulos"
                            (valueChanged)="filtrarPagina('moduloId',$event)" [ngModel]="this.filtro.moduloId"
                            name="moduloId">
                        </ng-select2>
                    </div>
                    <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12">
                        <label><b>Estado</b></label><br>
                        <ng-select2 [options]="options" [data]="this.estados"
                            (valueChanged)="filtrarPagina('estado',$event)" [ngModel]="this.filtro.estado" name="estado">
                        </ng-select2>
                    </div>
    
                    <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12" *ngIf="this.getAuth?.user?.aceder_todos_agentes">
                        <label><b>Tipo de orgão</b></label>
                        <ng-select2 [options]="options" [data]="this.tipoEstruturaOrganicas"
                            (valueChanged)="selecionarOrgaoOuComandoProvincial($event);" [ngModel]="this.filtro.tipoOrgao"
                            name="tipoOrgao">
                        </ng-select2>
                    </div>
    
                    <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12" *ngIf="this.getAuth?.user?.aceder_todos_agentes">
                        <label><b>Orgão</b></label>
                        <ng-select2 [options]="options" (valueChanged)="filtrarPagina('orgaoId',$event)"
                            [data]="this.direcaoOuOrgao" [ngModel]="this.filtro.orgaoId" name="orgaoId">
                        </ng-select2>
                    </div>
    
                </aside>
            </div>
    
            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
                <table class="table table-border table-striped custom-table datatable mb-0">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nome Utilizador</th>
                            <th>Email</th>
                            <th>Estado</th>
                            <th>Colocação</th>
                            <th>Módulo</th>
                            <th>Perfil</th>
                            <th>Data de Registado </th>
                            <th class="text-center">Operação</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr
                            *ngFor="let item of utilizadores | paginate: { itemsPerPage: this.pagination.per_page, currentPage: this.pagination.current_page,totalItems: this.pagination.total,id:'idUtilizadorTable' }; index as i">
                            <td>{{this.totalBase + i}}</td>
                            <td>{{item.username}}</td>
                            <td>{{item.email}}</td>
                            <td>
                                <ng-container *ngIf="item.activo; else elseTemplate">
                                    <span class="custom-badge status-green">Activo</span>
                                </ng-container>
                                <ng-template #elseTemplate>
                                    <span class="custom-badge status-red">Inactivo</span>
                                </ng-template>
                            </td>
                            <td>{{item.orgao ?? 'S/N'}}</td>
                            <td>{{item.modulo_nome}}</td>
                            <td>{{item.role_nome}}</td>
                            <td>{{item.createdAt}}</td>
                            <!-- <td>{{item.updatedAt}}</td> -->
                            <td class="text-center">
    
                                <div class="dropdown dropdown-action">
                                    <a href="#" class="action-icon dropdown-toggle" data-toggle="dropdown"
                                        aria-expanded="false"><i class="fa fa-ellipsis-v"></i></a>
    
                                    <div class="dropdown-menu dropdown-menu-right">
                                        <a class="dropdown-item" href="#"><i class="fa fa-eye m-r-5"></i>
                                            Visualizar</a>
                                        <a class="dropdown-item" href="javarcript::void(0)" data-toggle="modal"
                                            data-target="#modalRegistarOuEditarUtilizador" (click)="editar(item)">
                                            <i class="fa fa-pencil m-r-5"></i>
                                            Editar
                                        </a>
                                        <a class="dropdown-item" href="javarcript::void(0)" data-toggle="modal"
                                            data-target="#reset-password" (click)="visualizar(item)">
                                            <i class="fa fa-lock m-r-5"></i>
                                            Redefinir senha
                                        </a>
                                        <a class="dropdown-item" href="javarcript::void(0)" data-toggle="modal"
                                            data-target="#activa-desactiva-utilizador" (click)="visualizar(item)">
                                            <ng-container *ngIf="item.activo; else inActivo">
                                                <i class="fa fa-times m-r-5"></i>
                                                Desactivar
                                            </ng-container>
                                            <ng-template #inActivo>
                                                <i class="fa fa-check m-r-5"></i>
                                                Activar
                                            </ng-template>
                                        </a>
                                        <a class="dropdown-item" href="#" data-toggle="modal" (click)="visualizar(item)"
                                            data-target="#eliminar-utilizador"><i class="fa fa-trash-o m-r-5"></i>
                                            Eliminar</a>
                                    </div>
                                </div>
    
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
    
            <div class="col-md-12">
                <div class="row">
                    <div class="col-sm-6">
                        Mostrando de {{ this.pagination.current_page }} á
                        {{ this.pagination.per_page }} de {{ this.pagination.total }} Registo
                    </div>
                    <div class="col-sm-6">
                        <div class="float-right">
                            <pagination-controls id="idUtilizadorTable" (pageChange)="this.filtrarPagina('page', $event)"
                                [directionLinks]="true" [autoHide]="true" previousLabel="Anterior" nextLabel="Próximo"
                                [maxSize]="4" [responsive]="true"></pagination-controls>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<sigt-registar-ou-editar-modal (eventRegistarOuEditModel)="this.buscarUtilizadores()"
    [utilizador]="this.utilizador"></sigt-registar-ou-editar-modal>