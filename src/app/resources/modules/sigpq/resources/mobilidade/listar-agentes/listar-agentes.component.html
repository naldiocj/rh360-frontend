<div class="content">
  <sigpq-header></sigpq-header>
  <div class="header-ficha mt-1">
    <div class="row my-6">
      <div class="col-xl-8 col-lg-8 col-md-6 col-sm-12">
        <h4 class="text-light">
          <b>Listagem dos efectivos para mobilidade</b>
        </h4>
      </div>
    </div>
    <div class="row my-6">
      <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 d-flex justify-content-end align-item-center">
        <div class="d-flex justify-content-end align-items-center" *ngIf="this.getTemAgentesSelecionados">
          <a href="javascript:void(0)" data-toggle="modal" data-target="#modalRegistarAlocacao"
            class="btn-piips btn-piips-secondary border py-2 m-0">
            <i class="fa fa-plus-circle"></i>
            {{
            this.getMaisAgentesSelecionados
            ? 'Mover selecionados'
            : 'Mover selecionado'
            }}
          </a>
          <a href="javascript:void(0)" data-toggle="modal" data-target="#modalVerSelecionados"
            class="btn-piips btn-piips-secondary border py-2 m-0">
            <i class="fa fa-eye"></i>
            {{
            this.getMaisAgentesSelecionados
            ? 'Ver todos selecionados'
            : 'Ver todo selecionado'
            }}
          </a>
        </div>
        <div class="d-flex justify-content-end align-items-start">
          <button class="btn-piips btn-piips-secondary m-0 py-2 border" data-toggle="collapse" href="#pesquisa-avancada"
            role="button" aria-expanded="false" aria-controls="pesquisa-avancada" style="cursor: pointer;"> <i
              class="fa fa-search mx-2"></i>Pesquisa avançada</button>
          <!-- <a href="javascript:void(0)" href="javascript:void(0)" data-toggle="modal" data-target="#"
                class="btn-piips btn-piips-secondary border m-0 py-2 px-4"><i class="fa fa-list-alt"></i>
                Exportar</a> -->
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
      <fieldset class="w-100 p-1">
        <div class="row">
          <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 my-3">
            <aside class="row" style="align-items: center; row-gap: .4rem;">
              <div class="col-xl-1 col-lg-1 col-md-4 col-sm-12">
                <select class="form-control w-100" (change)="filtrarPagina('perPage',$event)">
                  <option *ngFor="let item of [5,10,20,50]" [value]="item">{{item}}</option>
                </select>
              </div>

              <div class="col-xl-9 col-lg-9 col-md-8 col-sm-12">
                <input class="form-control w-100" type="text" [ngModel]="filtro.search"
                  (ngModelChange)="filtrarPagina('search',$event)" placeholder="Pesquisar nome completo, nip, nas, ...">
              </div>
              <div class="col-xl-2 col-lg-2 col-md-12 col-sm-12 d-flex justify-content-end align-item-center">
                <button type="button" (click)="this.recarregarPagina()"
                  class="btn-piips btn-piips-secondary m-0 py-2 w-100" type="submit">
                  <i style="font-size: 14px;" class="fa fa-refresh fa-spin fa-3x fa-fw"></i>
                  <b>Recarregar</b>
                </button>
              </div>
            </aside>
          </div>
          <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
            <aside class="row collapse" id="pesquisa-avancada">
              <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 mb-4">
                <label for=""><b>Regime de Carreira</b></label>
                <ng-select2 [data]="this.regimes" [options]="this.options" [ngModel]="this.filtro.regimeId"
                  name="regimeId" (valueChanged)="filtrarPagina('regimeId',$event)">
                </ng-select2>
              </div>
              <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 mb-4">
                <label for=""><b>Tipo de Vínculo</b></label>
                <ng-select2 [data]="this.tipoVinculos" [options]="this.options" [ngModel]="this.filtro.tipoVinculoId"
                  name="tipoVinculoId" (valueChanged)="filtrarPagina('tipoVinculoId',$event)">
                </ng-select2>
              </div>
              <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 mb-4" > <!-- *ngIf="this.mostrarCarreira" -->
                <label for=""><b>{{ filtro.regimeId === '2' ? 'Carreira' : 'Classe' }}</b></label><br>
                <ng-select2 [data]="this.patenteClasses" [ngModel]="this.filtro.patenteClasse" name="patenteClasse"
                  (valueChanged)="filtrarPagina('patenteClasse',$event)" [options]="this.options">

                </ng-select2>
              </div>

              <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 mb-4" >
                <label for=""><b>{{ filtro.regimeId === '2' ? 'Categoria' : 'Posto' }}</b></label><br>
                <ng-select2 [data]="this.patentes" [options]="this.options" [ngModel]="this.filtro.patenteId"
                  name="patenteId" (valueChanged)="filtrarPagina('patenteId',$event)">
                </ng-select2>
              </div>
              <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 mb-4">
                <label for=""><b>Gênero</b></label>
                <ng-select2 [options]="options" [ngModel]="this.filtro.genero" name="genero"
                  (valueChanged)="filtrarPagina('genero',$event)" [data]="this.generos">
                </ng-select2>
              </div>
              <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 mb-4">
                <label for=""><b>Situação Laboral <span class="text-danger"></span></b></label>
                <ng-select2 [options]="options" [ngModel]="this.filtro.situacaoId" name="situacaoId" (valueChanged)="this.filtrarPagina('situacaoId',$event)"
                  [data]="this.situacaoEstados">
                </ng-select2>
              </div>
              <div class="col-xl-3 col-lg-4 col-md-6  col-sm-12 mb-4">
                <label for=""><b>{{this.tituloSituacao}} <span class="text-danger">&nbsp;</span></b></label>
                <ng-select2 [options]="options" [ngModel]="this.filtro.estadoId" name="estadoId"  (valueChanged)="this.filtrarPagina('estadoId',$event)"
                  [data]="this.estado">
                </ng-select2>
              </div>

              <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 mb-4" *ngIf="this.getAuth?.user?.aceder_todos_agentes">
                <label for=""><b>Tipo de Órgão</b></label>
                <ng-select2 [options]="options" [data]="this.tipoEstruturaOrganicas"
                  (valueChanged)="selecionarOrgaoOuComandoProvincial($event);">
                </ng-select2>
              </div>

              <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 mb-4" *ngIf="this.getAuth?.user?.aceder_todos_agentes">
                <label for=""><b>Direcção/Comando </b></label>
                <ng-select2 [options]="options" (valueChanged)="filtrarPagina('orgaoId',$event)" [data]="this.orgaos"
                  [ngModel]="this.filtro.orgaoId" name="orgaoId">
                </ng-select2>
              </div>
              <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 mb-4">
                <label for=""><b>Faixa Etária (De-Até)</b></label>
                <div class="d-flex">
                  <input [min]="this.idadeMenos" type="number" [ngModel]="this.filtro.idadeMenos" class="form-control"
                    (change)="filtrarPagina('idadeMenos',$event)">

                  <input [min]="this.filtro.idadeMenos!='null' ? this.filtro.idadeMenos : this.idadeMenos" type="number"
                    [ngModel]="this.filtro.idadeMais" class="form-control" (change)="filtrarPagina('idadeMais',$event)">
                </div>

              </div>
              <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 mb-4">
                <label for=""><b>Tempo de Serviço (De-Até)</b></label>
                <div class="d-flex">
                  <input type="number" class="form-control" [ngModel]="this.filtro.anoMenos" [min]="0"
                    (change)="filtrarPagina('anoMenos',$event)">

                  <input type="number" class="form-control" [ngModel]="this.filtro.anoMais"
                    [min]="this.filtro.anoMenos!='null' ? this.filtro.anoMenos : 0 "
                    (change)="filtrarPagina('anoMais',$event)">
                </div>
              </div>
            </aside>
          </div>
        </div>
      </fieldset>
    </div>
  </div>
  <div class="row">
    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
      <div class="table-responsive">


        <table class="table table-border table-striped custom-table datatable mb-0">
          <thead>
            <tr>
              <th><input
                type="checkbox"
                [checked]="estaTudoPreenchido"
                (change)="selecionarTodosEfectivos($event)"
              /></th>
              <th>ID</th>
              <th>Posto</th>
              <th>Nome Completo</th>
              <th>NIP</th>
              <th>NAS</th>
              <th class="text-center">Colocação actual</th>
              <th>Colocação anterior</th>
              <th>Data de Útlima atualização</th>
              <th class="text-right">Operação</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngIf="this.isLoading">
              <td colspan="11">
                <aside *ngIf="this.isLoading">
                  <loading-page [texto]="'lista de agentes'"></loading-page>
                </aside>
              </td>
            </tr>
            <tr *ngFor="
              let item of this.funcionarios
                | paginate
                  : {
                      id: 'funcionarioEspecial',
                      itemsPerPage: this.pagination.per_page,
                      currentPage: this.pagination.current_page,
                      totalItems: this.pagination.total
                    };
              index as i
            ">
              <td>
                <input type="checkbox" [checked]="isSelecionado(item)"
                (change)="toggleExportarFuncionario($event, item,this.totalBase + i)" />
              </td>
              <td>{{ this.totalBase + i }}</td>
              <td>
                <ng-container *ngIf="item.patente_nome; else elseTemplate">
                  {{ item.patente_nome }}
                </ng-container>
                <ng-template #elseTemplate>
                  S/N
                </ng-template>
              </td>
              <td>
                <strong>
                  <a routerLink="/" ariaCurrentWhenActive="page"
                    [routerLink]="['/piips/sigpg/perfil/', item.id, 'mobilidade']" style="font-size: 15px;">
                    {{ item.nome_completo | uppercase }}
                    {{ item.apelido | uppercase }}
                  </a>
                </strong>
              </td>
              <td class="text-start">
                <ng-container *ngIf="item.nip && this.utilsHelper.temQuadro(item?.quadro!); else elseTemplate">
                  {{item.quadro}} {{item.nip}}
                </ng-container>
                <ng-template #elseTemplate>
                  S/N
                </ng-template>
              </td>
              <td class="text-center">
                <ng-container *ngIf="item.numero_agente; else elseTemplate">
                  {{ item.numero_agente }}
                </ng-container>
                <ng-template #elseTemplate>
                  S/N
                </ng-template>
              </td>
              <td class="text-center" [title]="item?.orgao?.nome ?? ''">
                <ng-container *ngIf="item.orgao?.nome; else elseOrgao">
                  {{ item?.orgao?.sigla }}
                </ng-container>
                <ng-template #elseOrgao>
                  S/N
                </ng-template>
              </td>
              <td class="text-center">
                {{item?.orgao?.sigla_passado ?? 'S/N'}}
              </td>
              <td>{{ item.updated_at }}</td>
              <td class="text-right">
                <div class="dropdown dropdown-action position-static">
                  <a href="#" class="action-icon dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                    <i class="fa fa-ellipsis-v"></i>
                  </a>
                  <div class="dropdown-menu dropdown-menu-right">
                    <!-- <a class="dropdown-item" href="javascript:void(0)" (click)="visualizar(item)" data-toggle="modal"
                      data-target="#modalVisualizarFicha">
                      <i class="fa fa-eye m-r-5"></i>
                      Documento
                    </a>
                    <a href="javascript:void(0)" class="dropdown-item">
                      <i class="fa fa-pencil m-r-5"></i>
                      Editar
                    </a> -->
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="col-md-12">
      <div class="row">
        <div class="col-sm-6">
          Mostrando de {{ this.pagination.current_page }} a
          {{ this.pagination.per_page }} de {{ this.pagination.total }}
          <aside *ngIf="this.pagination.total < 2; else outrosRegistos">
            registos
          </aside>
          <ng-template #outrosRegistos>registos</ng-template>
        </div>
        <div class="col-sm-6">
          <div class="float-right">
            <pagination-controls id="funcionarioEspecial" (pageChange)="this.filtrarPagina('page', $event, false)"
              [directionLinks]="true" [autoHide]="true" previousLabel="Anterior" nextLabel="Próximo" [maxSize]="4"
              [responsive]="true"></pagination-controls>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<app-sigpq-mobilidade-registar-ou-editar [agentesId]="this.agentesSelecionados"
  (eventRegistarOuEditModel)="this.buscarFuncionario(); this.limparVariaveis()"></app-sigpq-mobilidade-registar-ou-editar>

  <app-sigpq-mobilidade-ver-selecionados
  [agentesSelecionados]="agentesSelecionados"></app-sigpq-mobilidade-ver-selecionados>

<!-- <div class="modal fade" id="modalVisualizarFicha" aria-labelledby="modalVisualizarFicha" aria-hidden="true">
  <div class="modal-dialog" role="document" style="overflow-y: hidden; min-width: 40%;">
    <div class="modal-content">
      <div class="modal-header">
        <h5>
          <i class="fa fa-user"></i>
          Mobilidade
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="content p-4">
        <app-sigpq-mobilidade-pdf [listarPDF]="this.listarPDF"></app-sigpq-mobilidade-pdf>
      </div>
    </div>
  </div>
</div> -->
