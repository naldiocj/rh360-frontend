<div class="row">
  <div class="container-fluid">
    <div id="historico-colocacao" class="w-100">
      <div class="row">
        <div class="col-lg-12 col-xl-12 col-md-12 col-sm-12 ms-auto">
          <form class="m-0 w-100" [formGroup]="this.simpleForm">
            <div class="card mt-0 py-0" style="border-radius: 0px">
              <div class="row p-2 my-1" style="row-gap: 1.2rem">
                <h4 class="col-12">
                  <!-- Órgão de Proveniência -->
                  Órgão atual
                </h4>
                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
                  <label style="color: var(--use-color)" for=""
                    ><b>Tipo de Órgão<span class="text-red">*</span></b></label
                  >
                  <ng-select2
                    [options]="options"
                    [data]="this.tipoEstruturaOrganicas"
                    formControlName="orgao_anterior_id"
                  >
                  </ng-select2>
                </div>
                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
                  <label style="color: var(--use-color)" for=""
                    ><b>Direcção<span class="text-red">*</span></b></label
                  >
                  <ng-select2
                    [options]="options"
                    [data]="this.orgaos_anterior"
                    formControlName="pessoajuridicaPassadoId"
                    (valueChanged)="selecionarDirecao($event, 'anterior')"
                  >
                  </ng-select2>
                </div>

                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
                  <label for="" style="color: var(--use-color)"
                    ><b>Departamento</b></label
                  >
                  <ng-select2
                    [options]="options"
                    (valueChanged)="selecionarDepartamento($event, 'anterior')"
                    [data]="this.departamentos_anterior"
                    formControlName="departamentoPassadoId"
                  >
                  </ng-select2>
                </div>

                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
                  <label for="" style="color: var(--use-color)"
                    ><b>Secção</b></label
                  >
                  <!-- <ng-select2 [options]="options" [data]="this.seccoes_anterior" formControlName="nome_da_seccao_anterior">
                  </ng-select2> -->
                  <input
                    class="form-control"
                    type="text"
                    formControlName="seccao_anterior"
                  />
                </div>
                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
                  <label for="" style="color: var(--use-color)"
                    ><b>Brigada</b></label
                  >
                  <!-- <ng-select2 [options]="options" [data]="this.seccoes_anterior" formControlName="nome_da_brigada_anterior">
                  </ng-select2> -->
                  <input
                    class="form-control"
                    type="text"
                    formControlName="brigada_anterior"
                  />
                </div>
                <h4 class="col-12">Órgão de Destino</h4>
                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
                  <label for="" style="color: var(--use-color)"
                    ><b>Tipo de Órgão<span class="text-red">*</span></b></label
                  >
                  <ng-select2
                    [options]="options"
                    [data]="this.tipoEstruturaOrganicas"
                    formControlName="orgao_destino_id"
                  >
                  </ng-select2>
                  <!-- (valueChanged)="selecionarOrgaoOuComandoProvincial($event, 'actual')" -->
                </div>
                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
                  <label for="" style="color: var(--use-color)"
                    ><b>Direcção<span class="text-red">*</span></b></label
                  >
                  <ng-select2
                    [options]="options"
                    [data]="this.orgaos"
                    formControlName="direccao_destino_id"
                    (valueChanged)="selecionarDirecao($event, 'actual')"
                  >
                  </ng-select2>
                </div>
                <!-- <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
                  <label for="" style="color: var(--use-color)"
                    ><b>Unidade</b></label
                  >
                 
                  <input
                    class="form-control"
                    type="text"
                    formControlName="unidade_destino"
                  />
                </div> -->
                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
                  <label for="" style="color: var(--use-color)"
                    ><b>Departamento</b></label
                  >
                  <ng-select2
                    [options]="options"
                    (valueChanged)="selecionarDepartamento($event, 'actual')"
                    [data]="this.departamentos"
                    formControlName="departamento_id"
                  >
                  </ng-select2>
                </div>

                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
                  <label for="" style="color: var(--use-color)"
                    ><b>Secção</b></label
                  >
                  <!-- <ng-select2 [options]="options" [data]="this.seccoes" formControlName="seccao_destino_id">
                  </ng-select2> -->
                  <input
                    class="form-control"
                    type="text"
                    formControlName="seccao"
                  />
                </div>
                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
                  <label for="" style="color: var(--use-color)"
                    ><b>Brigada</b></label
                  >
                  <!-- <ng-select2 [options]="options" [data]="this.seccoes" formControlName="brigada_destino_id">
                  </ng-select2> -->
                  <input
                    class="form-control"
                    type="text"
                    formControlName="brigada"
                  />
                </div>
                <!-- <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
                  <label style="color:var(--use-color)" for=""><b>Posto/Classe<span class="text-red">*</span></b></label>
                  <ng-select2 [options]="options" [data]="this.patentes" formControlName="patente_id">
                  </ng-select2>
                </div> -->
                <!-- <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12 d-flex align-items-center justify-content-center">
                  <div class="d-flex flex-column flex-grow-1">
                    <label style="color:var(--use-color)" for=""><b>Ordem n.º<span class="text-red">*</span></b></label>
                    <input class="form-control" type="text" formControlName="numero_ordem" [ngClass]="{
                                    'is-invalid':
                                      this.simpleForm.controls?.numero_ordem.dirty &&
                                      this.simpleForm.controls?.numero_ordem.errors,
                                    'is-valid':
                                      this.simpleForm.controls?.numero_ordem.dirty &&
                                      !this.simpleForm.controls?.numero_ordem.errors
                                  }" />
                    <div *ngIf="this.simpleForm.controls?.numero_ordem?.dirty &&
                                            this.simpleForm.controls?.numero_ordem?.errors" class="invalid-feedback">
                      <div *ngIf="this.simpleForm.controls?.numero_ordem?.errors?.required">
                        Este campo é obrigatório
                      </div>
                      <div
                        *ngIf="this.simpleForm.controls?.numero_ordem?.dirty && this.simpleForm.controls?.numero_ordem?.errors">
                        <div *ngIf="this.simpleForm.controls?.numero_ordem?.errors?.pattern" style="color: #dc3545;">
                          Digite um n.º válido
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="d-flex flex-column flex-grow-1">
                    <label style="color:var(--use-color)" for=""><b>Data<span class="text-red">*</span></b></label>
                    <input id="data_acto" type="date" formControlName="data_ordem" class="form-control"
                      [max]="this.validarDataAdesao">
                  </div>
                </div> -->
                <div
                  class="col-xl-4 col-lg-6 col-md-6 col-sm-12 d-flex align-items-center justify-content-center"
                >
                  <div class="d-flex flex-column flex-grow-1">
                    <label style="color: var(--use-color)" for=""
                      ><b>Despacho n.º<span class="text-red">*</span></b></label
                    >
                    <input
                      class="form-control"
                      type="text"
                      formControlName="numero_despacho"
                      [ngClass]="{
                        'is-invalid':
                          this.simpleForm.controls?.numero_despacho.dirty &&
                          this.simpleForm.controls?.numero_despacho.errors,
                        'is-valid':
                          this.simpleForm.controls?.numero_despacho.dirty &&
                          !this.simpleForm.controls?.numero_despacho.errors
                      }"
                    />
                    <div
                      *ngIf="
                        this.simpleForm.controls?.numero_despacho?.dirty &&
                        this.simpleForm.controls?.numero_despacho?.errors
                      "
                      class="invalid-feedback"
                    >
                      <div
                        *ngIf="
                          this.simpleForm.controls?.numero_despacho?.errors
                            ?.required
                        "
                      >
                        Este campo é obrigatório
                      </div>
                      <div
                        *ngIf="
                          this.simpleForm.controls?.numero_despacho?.dirty &&
                          this.simpleForm.controls?.numero_despacho?.errors
                        "
                      >
                        <div
                          *ngIf="
                            this.simpleForm.controls?.numero_despacho?.errors
                              ?.pattern
                          "
                          style="color: #dc3545"
                        >
                          Digite um n.º válido
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="d-flex flex-column flex-grow-1">
                    <label style="color: var(--use-color)" for=""
                      ><b>Data<span class="text-red">*</span></b></label
                    >
                    <input
                      id="data_aco"
                      type="date"
                      formControlName="despacho_data"
                      class="form-control"
                      [max]="this.validarDataAdesao"
                    />
                  </div>
                </div>
                <div
                  class="col-xl-4 col-lg-6 col-md-6 col-sm-12 d-flex align-items-center justify-content-center"
                >
                  <div class="d-flex flex-column flex-grow-1">
                    <label style="color: var(--use-color)" for=""
                      ><b>Guia nº<span class="text-red">*</span></b></label
                    >
                    <input
                      class="form-control"
                      type="text"
                      formControlName="numero_guia"
                      [ngClass]="{
                        'is-invalid':
                          this.simpleForm.controls?.numero_guia.dirty &&
                          this.simpleForm.controls?.numero_guia.errors,
                        'is-valid':
                          this.simpleForm.controls?.numero_guia.dirty &&
                          !this.simpleForm.controls?.numero_guia.errors
                      }"
                    />
                    <div
                      *ngIf="
                        this.simpleForm.controls?.numero_guia?.dirty &&
                        this.simpleForm.controls?.numero_guia?.errors
                      "
                      class="invalid-feedback"
                    >
                      <div
                        *ngIf="
                          this.simpleForm.controls?.numero_guia?.errors
                            ?.required
                        "
                      >
                        Este campo é obrigatório
                      </div>
                      <div
                        *ngIf="
                          this.simpleForm.controls?.numero_guia?.dirty &&
                          this.simpleForm.controls?.numero_guia?.errors
                        "
                      >
                        <div
                          *ngIf="
                            this.simpleForm.controls?.numero_guia?.errors
                              ?.pattern
                          "
                          style="color: #dc3545"
                        >
                          Digite um n.º válido
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="d-flex flex-column flex-grow-1">
                    <label style="color: var(--use-color)" for=""
                      ><b>Data<span class="text-red">*</span></b></label
                    >
                    <input
                      id="data_aco"
                      type="date"
                      formControlName="data_ingresso"
                      class="form-control"
                      [max]="this.validarDataAdesao"
                    />
                  </div>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-12">
                  <label style="color: var(--use-color)" for=""
                    ><b
                      >Anexo de ordem de serviço. (formato pdf)
                      <span class="text-red">*</span></b
                    ></label
                  >
                  <div class="upload-img">
                    <div id="input-Img" class="upload-input">
                      <input
                        id="anexo-ordem"
                        type="file"
                        class="form-control"
                        accept="application/pdf"
                        (change)="this.uploadFile($event, 'anexo')"
                      />
                    </div>
                  </div>
                </div>
              </div>
              <div class="row p-2 my-1" style="row-gap: 1.2rem">
                <div
                  class="col-xl-12 col-lg-12 col-md-12 col-sm-12 d-flex justify-content-end align-items-center my-2"
                >
                  <button
                    class="btn-piips btn-piips-red m-0 py-1"
                    (click)="this.reiniciarFormulario()"
                  >
                    Cancelar
                  </button>

                  <!-- [disabled]="this.carregando || this.submitted || !this.simpleForm.valid" -->

                  <button
                    type="button"
                    (click)="onSubmit()"
                    class="btn-piips btn-piips-primary m-0 py-1"
                    style="border-radius: 0px"
                  >
                    <ng-container
                      *ngIf="
                        this.carregando || this.submitted;
                        else naoRegistar
                      "
                    >
                      <div class="spinner-border spinner-border-sm"></div>
                      Carregando...
                    </ng-container>
                    <ng-template #naoRegistar>
                      {{ this.getId ? "Editar" : "Registar" }}
                    </ng-template>
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="row my-4">
        <div class="col-md-12">
          <nav class="navbar navbar-light bg-light w-100">
            <div
              class="form-inline align-items-center d-flex justify-content-between w-100"
            >
              <div class="d-flex justify-content-start">
                <select
                  class="form-control mr-sm-1"
                  (change)="filtrarPagina('perPage', $event)"
                >
                  <option *ngFor="let item of [5, 10, 20, 50]" [value]="item">
                    {{ item }}
                  </option>
                </select>
                <input
                  class="form-control mr-sm-1"
                  type="text"
                  [ngModel]="filtro.search"
                  name="search"
                  placeholder="Pesquisa ..."
                  (ngModelChange)="filtrarPagina('search', $event)"
                />
                <button
                  class="btn-piips btn-piips-primary py-2 m-0"
                  (click)="this.recarregarPagina()"
                >
                  <i
                    style="font-size: 14px"
                    class="fa fa-refresh fa-spin fa-3x fa-fw"
                  ></i>
                  <b>Recarregar</b>
                </button>
              </div>
              <!-- <div class="d-flex justify-content-end">
                <button disabled class="btn-piips btn-piips-primary py-2 m-0 " type="button">
                  <i style="font-size: 14px" class="fa fa-download  fa-3x fa-fw"></i>
                  <b>Exportar</b>
                </button>
              </div> -->
            </div>
          </nav>
        </div>

        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
          <div class="table-responsive">
            <table
              class="table table-border table-striped custom-table datatable mb-0 text-center"
            >
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Colocação</th>
                  <th>Colocação Anterior</th>
                  <th>Despacho n.º</th>
                  <th>Guia n.º</th>
                  <th>Situação</th>
                  <th>Data de registo</th>
                  <th colspan="4">Operação</th>
                </tr>
              </thead>
              <tbody>
                <tr
                  *ngFor="
                    let item of this.mobilidades
                      | paginate
                        : {
                            id: 'mobilidadeId',
                            itemsPerPage: this.pagination.per_page,
                            currentPage: this.pagination.current_page,
                            totalItems: this.pagination.total
                          };
                    index as i
                  "
                >
                  <td>{{ i + 1 }}</td>
                  <td>{{ item?.pessoajuridica_actual }}</td>
                  <td>{{ item?.pessoajuridica_passado ?? "S/N" }}</td>
                  <td>{{ item?.despacho_descricao ?? "S/N" }}</td>
                  <td>
                    <ng-container *ngIf="item?.numero_guia; else semGuia">
                      <a
                        ariaCurrentWhenActive="page"
                        [routerLink]="[
                          '/piips/sigpg/mobilidade/',
                          this.formatarGuia(item?.numero_guia)
                        ]"
                      >
                        {{ item.numero_guia | uppercase }}
                      </a>
                    </ng-container>
                    <ng-template #semGuia> S/N </ng-template>
                  </td>
                  <!-- <td>
            <ng-container *ngIf="this.eData(item?.data_ingresso); else semData">
              {{ this.getDataExtensao(item?.data_ingresso) }}
            </ng-container>
            <ng-template #semData> S/D </ng-template>
          </td> -->
                  <td>
                    <span *ngIf="item.activo" class="custom-badge status-green"
                      >Actual</span
                    >
                    <span
                      *ngIf="!item.activo"
                      class="custom-badge status-orange"
                      >Anterior</span
                    >
                  </td>
                  <td>{{ item.created_at }}</td>
                  <td class="text-right">
                    <div class="dropdown dropdown-action position-static">
                      <a
                        href="#"
                        class="action-icon dropdown-toggle"
                        data-toggle="dropdown"
                        aria-expanded="false"
                        ><i class="fa fa-ellipsis-v"></i
                      ></a>
                      <div class="dropdown-menu">
                        <a
                          class="dropdown-item"
                          href="javascript:void(0)"
                          data-toggle="modal"
                          data-target="#modalEditarMobilidade"
                          (click)="mobilidadeSelecionado(item)"
                        >
                          <i class="fa fa-eye m-r-5"></i>
                          Editar Data
                        </a>

                        <a
                          class="dropdown-item"
                          data-target="#modal-ordem-servico"
                          data-toggle="modal"
                          (click)="visualizar(item)"
                          ><i class="fa fa-file m-r-5"></i>
                          Visualizar documento
                        </a>
                      </div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="col-md-12">
          <div class="row">
            <div class="col-sm-6">
              Mostrando de {{ this.pagination.current_page }} á
              {{ this.pagination.per_page }} de
              {{ this.pagination.total }} Registo
            </div>
            <div class="col-sm-6">
              <div class="float-right">
                <pagination-controls
                  id="provimentoId"
                  (pageChange)="this.filtrarPagina('page', $event)"
                  [directionLinks]="true"
                  [autoHide]="true"
                  previousLabel="Anterior"
                  nextLabel="Próximo"
                  [maxSize]="4"
                  [responsive]="true"
                ></pagination-controls>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div
    class="modal fade"
    id="modalEditarMobilidade"
    aria-labelledby="modalEditarMobilidade"
    aria-hidden="true"
  >
    <div
      class="modal-dialog"
      role="document"
      style="overflow-y: hidden; min-width: 40%"
    >
      <div class="modal-content">
        <div class="modal-header">
          <h5>
            <i class="fa fa-user"></i>
            Atualização de data da Mobilidade
          </h5>
          <button
            type="button"
            class="close"
            data-dismiss="modal"
            (click)="zerarFormularioAtualziacao()"
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="content">
          <form [formGroup]="updateDataForm" (ngSubmit)="atualizarDados()">
            <div class="modal-body">
              <div class="row">
                <div class="col-sm-12">
                  <div class="col-12 d-flex align-item-center">
                    <div class="d-flex flex-column w-50 pr-2">
                      <label for=""
                        ><b
                          >Despacho n.º<span class="text-red">*</span></b
                        ></label
                      >
                      <input
                        class="form-control"
                        type="text"
                        formControlName="numero_despacho"
                        [ngClass]="{
                          'is-invalid':
                            updateDataForm.controls?.numero_despacho.dirty &&
                            updateDataForm.controls?.numero_despacho.errors,
                          'is-valid':
                            updateDataForm.controls?.numero_despacho.dirty &&
                            !updateDataForm.controls?.numero_despacho.errors
                        }"
                      />
                      <div
                        *ngIf="
                          updateDataForm.controls?.numero_despacho?.dirty &&
                          updateDataForm.controls?.numero_despacho?.errors
                        "
                        class="invalid-feedback"
                      >
                        <div
                          *ngIf="
                            updateDataForm.controls?.numero_despacho?.errors
                              ?.required
                          "
                        >
                          Este campo é obrigatório
                        </div>
                        <div
                          *ngIf="
                            updateDataForm.controls?.numero_despacho?.errors
                              ?.pattern
                          "
                          style="color: #dc3545"
                        >
                          Digite um N.º válido
                        </div>
                      </div>
                    </div>
                    <div class="d-flex flex-column flex-grow-1">
                      <label for=""
                        ><b>Data XXX<span class="text-red">*</span></b></label
                      >
                      <input
                        type="date"
                        formControlName="despacho_data"
                        class="form-control"
                      />
                    </div>
                  </div>
                  <div class="col-12 d-flex align-item-center mt-3">
                    <div class="d-flex flex-column w-50 pr-2">
                      <label for=""
                        ><b>Guia n.º<span class="text-red">*</span></b></label
                      >
                      <input
                        class="form-control"
                        type="text"
                        formControlName="numero_guia"
                        [ngClass]="{
                          'is-invalid':
                            updateDataForm.controls?.numero_guia.dirty &&
                            updateDataForm.controls?.numero_guia.errors,
                          'is-valid':
                            updateDataForm.controls?.numero_guia.dirty &&
                            !updateDataForm.controls?.numero_guia.errors
                        }"
                      />
                      <div
                        *ngIf="
                          updateDataForm.controls?.numero_guia?.dirty &&
                          updateDataForm.controls?.numero_guia?.errors
                        "
                        class="invalid-feedback"
                      >
                        <div
                          *ngIf="
                            updateDataForm.controls?.numero_guia?.errors
                              ?.required
                          "
                        >
                          Este campo é obrigatório
                        </div>
                        <div
                          *ngIf="
                            updateDataForm.controls?.numero_guia?.errors
                              ?.pattern
                          "
                          style="color: #dc3545"
                        >
                          Digite um N.º válido
                        </div>
                      </div>
                    </div>
                    <div class="d-flex flex-column flex-grow-1">
                      <label for=""
                        ><b>Data<span class="text-red">*</span></b></label
                      >
                      <input
                        id="data_guia"
                        type="date"
                        formControlName="guia_data"
                        class="form-control"
                        [max]="validarDataAdesao"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                (click)="zerarFormularioAtualziacao()"
                data-dismiss="modal"
              >
                <span class="fa fa-close m-r-2"></span>Fechar
              </button>
              <button
                type="submit"
                class="btn btn-primary"
                (click)="atualizarDados()"
              >
                <span class="fa fa-save m-r-2"></span>Atualizar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div
    class="modal fade"
    id="modal-ordem-servico"
    aria-labelledby="modalCargoVisual"
    aria-hidden="true"
  >
    <div
      class="modal-dialog"
      role="document"
      style="overflow-y: hidden; min-width: 70%"
    >
      <div class="modal-content">
        <div class="modal-header">
          <h5>
            <i class="fa fa-user"></i>
            Visualizar guia de Serviço
          </h5>
          <button
            type="button"
            class="close"
            data-dismiss="modal"
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="content">
          <div class="modal-body">
            <div class="row">
              <div class="col-sm-12">
                <nav class="navbar navbar-light bg-light">
                  <h5>Guia de Serviço - {{ this.documento?.numero_ordem }}</h5>
                  <aside *ngIf="this.documento">
                    <span
                      *ngIf="this.documento?.situacao == 'actual'"
                      class="custom-badge status-green"
                      >Actual</span
                    >
                    <span
                      *ngIf="this.documento?.activo == 'exercída'"
                      class="custom-badge status-orange"
                      >Exercída</span
                    >
                  </aside>
                </nav>
                <div class="col-sm-12">
                  <aside
                    *ngIf="carregarDocumento; else carregarDocumentoVerMensagem"
                  >
                    <div class="container">
                      <div class="row justify-content-center">
                        Carregando documento ...
                        <div class="col-sm-12 text-center">
                          <div
                            class="spinner-border text-primary"
                            style="width: 2rem; height: 2rem"
                            role="status"
                          ></div>
                        </div>
                      </div>
                    </div>
                  </aside>
                  <ng-template #carregarDocumentoVerMensagem>
                    <aside *ngIf="fileUrl; else verMensagem">
                      <iframe
                        [src]="fileUrl"
                        width="100%"
                        height="700px"
                      ></iframe>
                    </aside>
                    <ng-template #verMensagem>
                      <div class="container">
                        <div class="row justify-content-center">
                          <div class="col-sm-12 text-center">
                            Sem documento adicionado
                          </div>
                        </div>
                      </div>
                    </ng-template>
                  </ng-template>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              <span class="fa fa-close m-r-2"></span>Fechar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
