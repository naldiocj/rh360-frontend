<div class="modal fade" id="cancelar-reclamacao" style="border-radius: unset">
  <div class="modal-dialog modal-dialog-centered modal-dialog-ms">
    <div class="modal-content">
      <div class="modal-header">
        <div
          class="modal-title w-100 d-flex justify-content-between align-items-center"
        >
          Cancelar / Eliminar a reclamação
          <a
            data-dismiss="modal"
            class="bi bi-x-lg text-danger"
            style="cursor: pointer"
          ></a>
        </div>
      </div>
      <div
        class="modal-body text-center"
        style="font-size: 16px; color: #041b43"
      >
        <span>Confirmas a continuação desta acção ?</span>
        <div class="btn-groups my-2">
          <a
            class="btn btn-link"
            style="text-decoration: none; color: #041b43"
            (click)="cancelarReclamacao(deleteById)"
            >Sim</a
          >
          <div
            class="btn btn-link"
            data-dismiss="modal"
            id="close-modal"
            style="text-decoration: none; color: #041b43"
          >
            Não
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  id="mostrarArquivo"
  aria-labelledby="modalPortalRegistarAcidente"
  aria-hidden="true"
>
  <div
    class="modal-dialog modal-lg"
    role="document"
    style="overflow-y: hidden; min-width: 30%"
  >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="title-header">Visualização de arquivo</h5>

        <button
          type="button"
          class="close"
          id="btn-close-modal"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="texto">
          <p [innerHTML]="this.text"></p>
        </div>
        <iframe [src]="this.fileUrl" class="iframe"></iframe>
      </div>
    </div>
  </div>
</div>

<main id="main_" class="main_">
  <div class="pagetitle mb-4">
    <h1>
      <i class="bi bi-envelope-fill"></i
      ><span class="mx-2">Listas de reclamações</span>
    </h1>
  </div>

  <section class="section">
    <div class="row">
      <div class="col-lg-12">
        <div class="card recent-sales overflow-auto">
          <div class="card-body">
            <div class="row">
              <div class="col-12">
                <div
                  class="card-body-header d-flex justify-content-between align-items-center my-2"
                >
                  <h5 class="card-title">Reclamações enviado para DPQ</h5>
                </div>
              </div>
              <div class="col-12 my-2">
                <form class="form-inline">
                  <select
                    id="perPageSelector"
                    class="form-control mr-sm-1"
                    (change)="filtrarPagina('perPage', $event)"
                  >
                    <option *ngFor="let item of [5, 10, 20, 50]" [value]="item">
                      {{ item }}
                    </option>
                  </select>
                  <input
                    class="form-control mr-sm-1"
                    type="text"
                    [ngModel]="filtro.search"
                    name="search"
                    (ngModelChange)="filtrarPagina('search', $event)"
                    placeholder="Pesquisa ..."
                  />
                  <button
                    (click)="this.recarregarPagina()"
                    id="btpe1"
                    class="btn btn-outline-success my-2 my-sm-0"
                    type="submit"
                  >
                    <i
                      style="font-size: 14px"
                      class="fa fa-refresh fa-spin fa-3x fa-fw"
                    ></i>
                    <b>Recarregar</b>
                  </button>
                </form>
              </div>
            </div>
            <div class="table-responsive">
              <table class="table text-center ms-auto">
                <!-- <table
                  class="table text-center table-border table-striped custom-table datatable mb-0"
                > -->
                <thead class="text-center">
                  <tr>
                    <th>ID</th>
                    <th>Mensagem</th>
                    <th>Arquivo</th>
                    <th scope="col">Enviado para</th>
                    <th scope="col">Direcção/Comando</th>
                    <th>Estado</th>
                    <th>Data de envio</th>
                    <th colspan="4">Operação</th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    *ngFor="
                      let item of this.reclamacoes
                        | paginate
                          : {
                              id: 'solicitacaoId',
                              itemsPerPage: this.pagination.per_page,
                              currentPage: this.pagination.current_page,
                              totalItems: this.pagination.total
                            };
                      index as i
                    "
                  >
                  <td>{{ i + 1 }}</td>

                    <td
                      [innerHTML]="item.texto?.toString().slice(0, 20) + '...'"
                    ></td>
                    <ng-container
                      *ngIf="item.nome_arquivo=='null' || item.nome_arquivo=='undefined';else tem"
                    >
                      <td>S/N</td>
                    </ng-container>
                    <ng-template #tem>
                      <td>{{ item.nome_arquivo }}</td>
                    </ng-template>
                    <td> {{ item.modulo_sigla | uppercase }}</td>
                    <td> {{ item.orgao | uppercase }}</td>

                    <td
                      class="badge w-100 p-2 text-light"
                      [style.backgroundColor]="this.getEstado(item.estado)?.cor"
                      style="border-radius: unset"
                    >
                      {{ this.getEstado(item.estado)?.nome }}
                    </td>
                    <td>{{ item.createdAt }}</td>
                    <td *ngIf="item.nome_arquivo!='null' && item.nome_arquivo!='undefined';">
                      <a
                        (click)="
                          this.download(item.documento, item.nome_arquivo)
                        "
                        class="btn bi bi-download"
                        title="Descarregar"
                      ></a>
                    </td>
                    <td>
                      <a
                        (click)="verArquivo(item.documento, item.texto)"
                        href="javascript:void(0)"
                        class="dropdown-item"
                        data-toggle="modal"
                        [style.cursor]="'pointer'"
                        data-target="#mostrarArquivo"
                        ariaCurrentWhenActive="page"
                        class="btn bi bi-eye-fill"
                        title="Ler a reclamação"
                      ></a>
                    </td>
                    <td>
                      <a
                        (click)="setRemoveID(item.id)"
                        data-toggle="modal"
                        data-target="#cancelar-reclamacao"
                        class="btn bi bi-eraser-fill"
                        title="Remover ficheiro"
                      ></a>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="col-md-12">
              <div class="row">
                <div class="col-lg-12">
                  Mostrando de {{ this.pagination.current_page }} a
                  {{ this.pagination.per_page }} de {{ this.pagination.total }}
                  <aside *ngIf="this.pagination.total < 2; else outrosRegistos">
                    registos
                  </aside>
                  <ng-template #outrosRegistos>registos</ng-template>
                </div>
                <div class="col-sm-6">
                  <div class="float-right">
                    <pagination-controls
                      id="funcionarioEspecial"
                      (pageChange)="this.filtrarPagina('page', $event)"
                      [directionLinks]="true"
                      [autoHide]="true"
                      previousLabel="Anterior"
                      nextLabel="Próximo"
                      [maxSize]="4"
                      [responsive]="true"
                    ></pagination-controls>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>
